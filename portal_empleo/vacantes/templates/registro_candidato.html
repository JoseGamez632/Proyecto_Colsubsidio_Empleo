{% extends 'base.html' %}

{% load static %}
{% block titulo %}
Inicio
{% endblock %}

{% block contenido %}
<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" rel="stylesheet" />
<style>
    /* Estilos generales del formulario */
    .card {
        border-radius: 15px;
        background: linear-gradient(145deg, #1a1a1a, #2d2d2d) !important;
    }
    
    .form-control {
        background-color: #2d2d2d !important;
        border: 1px solid #404040 !important;
        color: #ffffff !important;
        border-radius: 8px;
    }

    .form-control:focus {
        box-shadow: 0 0 0 0.2rem rgba(0,123,255,0.25);
        background-color: #333333 !important;
    }

    /* Estilos para Select2 */
    .select2-container--default .select2-selection--multiple {
        background-color: #2d2d2d !important;
        border: 1px solid #404040 !important;
        border-radius: 8px;
    }

    .select2-container--default .select2-selection--multiple .select2-selection__choice {
        background-color:#f8d047 !important;
        color: white !important;
        border: none !important;
        border-radius: 15px !important;
        padding: 2px 8px !important;
    }

    .select2-container--default .select2-results__option--highlighted[aria-selected] {
        background-color: #f8d047 !important;
        color: white !important;
    }

    .select2-container--default .select2-results__option[aria-selected=true] {
        background-color: #f8d047 !important;
        color: white !important;
    }

    .select2-dropdown {
        background-color: #2d2d2d !important;
        border: 1px solid #404040 !important;
    }

    .select2-search__field {
        background-color: #333333 !important;
        color: white !important;
    }

    .select2-results__option {
        color: #ffffff !important;
    }

    /* Estilos para labels */
    label {
        font-weight: 500;
        margin-bottom: 0.5rem;
        color: #e0e0e0 !important;
    }

    /* Estilos para el botón */
    .btn-primary {
        background: linear-gradient(145deg, #f8d047, #f8d047) !important;
        border: none;
        padding: 12px 25px;
        border-radius: 8px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 1px;
        transition: all 0.3s ease;
    }

    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px #f8d047;
    }

    /* Estilos para los grupos de form-row */
    .form-row {
        margin-bottom: 1.5rem;
    }

    /* Animación al cargar el formulario */
    .card {
        animation: fadeIn 0.5s ease-in-out;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }
</style>
<div class="container mt-5" style="text-align: center;">
    
    <h1 class="text-center">Formulario de Registro de Candidato</h1>
    
    <div class="card shadow-sm p-4 text-light bg-dark"  style="background-color: rgb(248, 248, 248);">
        
        {% if form.errors %}
        <div class="alert alert-danger">
            <ul>
                {% for field in form %}
                    {% for error in field.errors %}
                        <li>{{ error }}</li>
                    {% endfor %}
                {% endfor %}
            </ul>
        </div>
        {% endif %}

        <form method="post">
            {% csrf_token %}

            {% if request.user.is_authenticated %}
            <div class="form-row">
                <div class="form-group col-md-6">
                    <label for="feria">Feria</label>
                    {{ form.feria }}
                </div>
                <div class="form-group col-md-6">
                    <label for="fecha_feria">Fecha de Feria</label>
                    <input type="date" name="fecha_feria" id="fecha_feria" 
                           class="form-control" 
                           value="{{ form.fecha_feria.value|date:'Y-m-d' }}"
                           {% if form.fecha_feria.field.required %}required{% endif %}>
                </div>
            </div>
            {% endif %}   

            <div class="form-row">
                <div class="form-group col-md-6">
                    <label for="sexo">Sexo</label>
                    {{ form.sexo }}
                </div>
                <div class="form-group col-md-6">
                    <label for="tipo_documento">Tipo de Documento</label>
                    {{ form.tipo_documento }}
                </div>
            </div>

            <div class="form-row">
                <div class="form-group col-md-6">
                    <label for="numero_documento">Número de Documento</label>
                    {{ form.numero_documento }}
                </div>
                <div class="form-group col-md-6">
                    <label for="nombres">Nombres</label>
                    {{ form.nombres }}
                </div>
            </div>

            <div class="form-row">
                <div class="form-group col-md-6">
                    <label for="apellidos">Apellidos</label>
                    {{ form.apellidos }}
                </div>
                <div class="form-group col-md-6">
                    <label for="numero_celular">Número de Celular</label>
                    {{ form.numero_celular }}
                </div>
            </div>

            <div class="form-row">
                <div class="form-group col-md-6">
                    <label for="correo_electronico">Correo Electrónico</label>
                    {{ form.correo_electronico }}
                </div>
                <div class="form-group col-md-6">
                    <label for="fecha_nacimiento">Fecha de Nacimiento</label>
                    <input type="date" name="fecha_nacimiento" id="fecha_nacimiento" 
                           class="form-control" 
                           value="{{ form.fecha_nacimiento.value|date:'Y-m-d' }}"
                           {% if form.fecha_nacimiento.field.required %}required{% endif %}>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group col-md-6">
                    <label for="formacion_academica">Formación Académica</label>
                    {{ form.formacion_academica }}
                </div>
                <div class="form-group col-md-6">
                    <label for="programa_academico">Programa Académico</label>
                    {{ form.programa_academico }}
                </div>
            </div>

            <div class="form-row">
                <div class="form-group col-md-6">
                    <label for="experiencia_laboral">Experiencia Laboral</label>
                    {{ form.experiencia_laboral }}
                </div>
                <div class="form-group col-md-6">
                    <label for="interes_ocupacional">Interés Ocupacional</label>
                    {{ form.interes_ocupacional }}
                </div>
            </div>
            

            <div class="form-row">
                <div class="form-group col-md-6">
                    <label for="localidad_municipio">Localidad/Municipio</label>
                    {{ form.localidad_municipio }}
                </div>
                <div class="form-group col-md-6">
                    <label for="horario_interesado">Horario de Interés</label>
                    {{ form.horario_interesado }}
                </div>
            </div>

            <div class="form-row">
                <div class="form-group col-md-6">
                    <label for="aspiracion_salarial">Aspiración Salarial</label>
                    {{ form.aspiracion_salarial }}
                </div>
                <div class="form-group col-md-6">
                    <label for="registrado_en_sise">¿Está registrado en SISE?</label>
                    {{ form.registrado_en_sise }}
                </div>
            </div>

            <div class="form-row">
                {% if request.user.is_authenticated %}
                <div class="form-group col-md-6">
                    <label for="tecnico_seleccion">Técnico de Selección</label>
                    {{ form.tecnico_seleccion }}
                </div>
                {% endif %}   
            </div>

            <div class="form-row">
                <div class="form-group col-md-6">
                    <label for="candidato_discapacidad">¿Es candidato con discapacidad?</label>
                    {{ form.candidato_discapacidad }}
                </div>
                <div class="form-group col-md-6">
                    <label for="vacantes">Vacantes disponibles</label>
                    <select id="vacantes" name="vacantes_disponibles" class="form-control" multiple="multiple" >
                        {% for vacante in form.fields.vacantes_disponibles.queryset %}
                            <option value="{{ vacante.id }}" 
                                {% if vacante in selected_vacantes %}selected{% endif %}>
                                {{ vacante }}
                            </option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group col-md-6" id="tipo_discapacidad_container" style="display: none;">
                    <label for="tipo_discapacidad">Tipo de Discapacidad</label>
                    {{ form.tipo_discapacidad }}
                </div>
            </div>

            <button type="submit" class="btn btn-primary btn-block mt-3">
                {% if is_edit %}Actualizar{% else %}Registrar{% endif %}
            </button>
        </form>
    </div>
</div>

<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" rel="stylesheet" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Inicializar Select2 en el campo de vacantes
        $('#vacantes').select2({
            placeholder: "Seleccione vacantes",
            allowClear: true
        });

        // Si estamos en modo edición, no necesitamos cargar desde URL
        {% if not is_edit %}
            const urlParams = new URLSearchParams(window.location.search);
            const selectedVacantes = urlParams.get('selected_vacantes') ? urlParams.get('selected_vacantes').split(',') : [];
            $('#vacantes').val(selectedVacantes).trigger('change');
        {% endif %}
    });
</script>


{% comment %} script para mostrar el campo tipo_discapacidad cuando se selecciona la opción SI en candidato_discapacidad {% endcomment %}

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const discapacidadField = document.querySelector('[name="candidato_discapacidad"]');
        const tipoDiscapacidadContainer = document.getElementById('tipo_discapacidad_container');
    
        function toggleTipoDiscapacidad() {
            if (discapacidadField.value === 'SI') {
                tipoDiscapacidadContainer.style.display = 'block';
            } else {
                tipoDiscapacidadContainer.style.display = 'none';
            }
        }
    
        discapacidadField.addEventListener('change', toggleTipoDiscapacidad);
    
        // Inicializar el estado del campo al cargar la página
        toggleTipoDiscapacidad();
    });
    </script>



{% endblock %}