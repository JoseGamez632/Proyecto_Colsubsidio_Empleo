{% extends 'base.html' %}
{% load static %}

{% block titulo %}
Vacantes Disponibles
{% endblock %}

{% block contenido %}

<style> /* Texto de letras en filtros negro */
    .offcanvas-body input.form-control,
    .offcanvas-body select.form-control,
    .offcanvas-body .multiselect-improved {
        color: black !important;
    }
</style>
<style> /* Filtros Vacantes */
    /* Asegurar desplazamiento en el dropdown de Select2 */
    .select2-dropdown {
        max-height: 300px !important; /* Altura máxima del dropdown */
        overflow-y: auto !important; /* Habilitar scroll vertical */
        scrollbar-width: thin !important; /* Para Firefox */
        scrollbar-color: #3498db #34495e !important; /* Color de scrollbar */
    }

    /* Estilos de scrollbar para webkit (Chrome, Safari, newer versions of Opera) */
    .select2-dropdown::-webkit-scrollbar {
        width: 8px !important; /* Ancho del scrollbar */
    }

    .select2-dropdown::-webkit-scrollbar-track {
        background: #34495e !important; /* Color de fondo del track */
    }

    .select2-dropdown::-webkit-scrollbar-thumb {
        background-color: #3498db !important; /* Color del thumb */
        border-radius: 4px !important; /* Bordes redondeados */
    }

    .select2-dropdown::-webkit-scrollbar-thumb:hover {
        background-color: #2980b9 !important; /* Color al pasar el mouse */
    }

    /* Asegurar que el contenido del dropdown sea scrollable */
    .select2-results {
        max-height: 280px !important;
        overflow-y: auto !important;
    }

    /* Mejorar la interacción táctil */
    @media (max-width: 768px) {
        .select2-dropdown {
            max-height: 50vh !important; /* 50% de la altura de la ventana en dispositivos móviles */
        }
    }

    /* Estilos personalizados para Select2 */
    .select2-container {
        width: 100% !important;
    }
    
    .select2-container--bootstrap-5 .select2-selection {
        background-color:rgb(255, 255, 255) !important;
        border: 1px solid #343A40 !important;
        border-radius: 0.375rem !important;
        color: white !important;
        min-height: 38px !important;
    }
    
    /* Estilos para selección múltiple */
    .select2-container--bootstrap-5 .select2-selection--multiple {
        padding: 0.25rem 0.5rem !important;
        display: flex !important;
        flex-wrap: wrap !important;
        gap: 0.25rem !important;
        min-height: 38px !important;
    }
    
    .select2-container--bootstrap-5 .select2-selection--multiple .select2-selection__rendered {
        display: flex !important;
        flex-wrap: wrap !important;
        align-items: center !important;
        gap: 0.25rem !important;
        width: 100% !important;
    }
    
    .select2-container--bootstrap-5 .select2-selection--multiple .select2-selection__placeholder {
        color: white !important;
        opacity: 0.7 !important;
        position: absolute !important;
        left: 50% !important;
        transform: translateX(-50%) !important;
    }
    
    .select2-container--bootstrap-5 .select2-selection--multiple .select2-selection__choice {
        background-color: #3498db !important;
        color: white !important;
        border: none !important;
        border-radius: 0.25rem !important;
        margin: 0.1rem !important;
        padding: 0.2rem 0.5rem !important;
        display: inline-flex !important;
        align-items: center !important;
        font-size: 0.875rem !important;
        max-width: calc(100% - 0.5rem) !important;
    }
    
    .select2-container--bootstrap-5 .select2-selection--multiple .select2-selection__choice__remove {
        color: white !important;
        margin-left: 0.25rem !important;
        opacity: 0.7 !important;
    }
    
    .select2-container--bootstrap-5 .select2-selection--multiple .select2-selection__choice__display {
        max-width: 150px !important;
        white-space: nowrap !important;
        overflow: hidden !important;
        text-overflow: ellipsis !important;
    }
    
    /* Estilos para el dropdown */
    .select2-dropdown {
        background-color: #34495e !important;
        color: white !important;
    }
    
    .select2-results__option {
        background-color: #34495e !important;
        color: white !important;
        padding: 0.5rem !important;
    }
    
    .select2-results__option--highlighted {
        background-color: #3498db !important;
        color: white !important;
    }
    
    /* Responsividad */
    @media (max-width: 576px) {
        .select2-container--bootstrap-5 .select2-selection--multiple .select2-selection__choice {
            margin: 0.1rem !important;
            padding: 0.1rem 0.3rem !important;
            font-size: 0.75rem !important;
        }
    
        .select2-container--bootstrap-5 .select2-selection--multiple .select2-selection__choice__display {
            max-width: 100px !important;
        }
    }
</style>
<style>
    /* Estilos para el contenedor de paginación */
    .pagination {
        margin-bottom: 2rem; /* Mueve el paginador un poco hacia arriba */
        margin-top: 2rem; /* Ajusta el espacio superior si es necesario */
    }

    /* Estilos para los botones/enlaces de paginación */
    .pagination .btn-outline-secondary {
        background-color: #ffc107 !important; /* Fondo amarillo (Bootstrap warning) */
        color: #212529 !important; /* Texto oscuro para mejor contraste con amarillo */
        border-color: #e0a800 !important; /* Borde un poco más oscuro */
        font-weight: bold;
    }

    /* Estilo para los botones al pasar el mouse */
    .pagination .btn-outline-secondary:hover {
        background-color: #e0a800 !important; /* Amarillo más oscuro al pasar el mouse */
        color: #000 !important; /* Texto negro al pasar el mouse */
        border-color: #c69500 !important;
    }

    /* Estilo para el texto "Página X de Y" */
    .pagination .current {
        color: #ffc107; /* Color amarillo para el texto central */
        font-weight: bold;
        vertical-align: middle; /* Alinea verticalmente con los botones */
        padding-top: .375rem; /* Ajuste vertical similar al padding de los botones sm */
        padding-bottom: .375rem;
    }

        /* Estilos para el contenedor del selector "Vacantes por página" */
        #items-por-pagina-selector {
            margin-top: 0.5rem; /* Ajusta el espacio sobre el selector (más pequeño que mt-2) */
            margin-bottom: 2rem; /* Espacio debajo del selector antes del final */
        }
        #items-por-pagina-selector label {
            color: #adb5bd; /* Color gris claro para la etiqueta, similar a Bootstrap */
            margin-right: 0.5rem; /* Espacio entre etiqueta y select */
        }
</style>
<style>
    /* Estilos para botones de cambio de vista (copiados de lista_registros.html) */
    .view-toggle-btn {
        margin-right: 10px;
        background-color: #6c757d; /* Color secundario de Bootstrap por defecto */
        border-color: #6c757d;
    }
    .view-toggle-btn.active {
        background-color: #ffc107 !important; /* Amarillo para el activo */
        color: #212529 !important;
        border-color: #e0a800 !important;
        font-weight: bold;
    }
    .view-toggle-btn:not(.active):hover {
        background-color: #5a6268;
        border-color: #545b62;
    }
    /* Estilo para la tabla */
    #table-view {
        display: none; /* Oculta por defecto */
    }
</style>
<style>
    .vacante-card.selected {
    box-shadow: 0 0 10px 3px rgba(40, 167, 69, 0.8);
    border: 2px solid #28a745;
    transition: all 0.3s ease-in-out;
}

    
    .descripcion-vacante {
    white-space: pre-line;
}

/* Estilos generales */
.vacante-card {
    width: 100%;
    max-width: 95%;
    word-wrap: break-word;
    overflow: hidden;
    text-align: center;
    padding: 15px;
    margin-bottom: 15px;
    background: rgba(33, 37, 41, 0.8);
    backdrop-filter: blur(5px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 8px;
    transition: all 0.3s ease;
    color: white;
    position: relative;
}

.vacante-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
}

.vacante-title {
    font-size: 1.8rem;
    font-weight: bold;
    color: #ffc107;
    margin-bottom: 10px;
    position: relative;
    z-index: 5;
}

.vacante-location {
    background-color: #ffc107;
    color: #333 !important;
    padding: 3px 6px;
    margin: 2px 0;
    display: inline-block;
    border-radius: 3px;
    font-weight: bold;
    font-size: 0.85em;
}

h1.text-warning.mb-4.fw-bold {
    font-size: 2.5rem !important;
    font-weight: bold !important;
    color: #ffc107 !important;
    text-align: center !important;
    margin-bottom: 2rem !important;
}

.grid-container {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); /* Mejor ajuste en móviles */
    gap: 15px;
    padding: 10px;
}

/* Botón flotante */
.floating-button {
    position: fixed;
    bottom: 20px;
    left: 20px;
    z-index: 1000;
    background-color: #ffc107;
    color: black;
    border-radius: 50px;
    padding: 10px 20px;
    font-size: 16px;
    font-weight: bold;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    transition: all 0.3s ease;
}

.floating-button:hover {
    background-color: #ffca2c;
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
}

/* Switch Estado de Vacante */
.switch {
    position: relative;
    display: inline-block;
    width: 86px;
    height: 30px;
}

.switch input {
    opacity: 0;
    width: 0;
    height: 0;
}

.slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: red;
    transition: .4s;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 12px;
}

.slider:before {
    position: absolute;
    content: "";
    height: 12px;
    width: 12px;
    left: 4px;
    bottom: 9px;
    background-color: white;
    transition: .4s;
}

input:checked + .slider {
    background-color: green;
}

input:checked + .slider:before {
    transform: translateX(66px);
}

.slider.round {
    border-radius: 34px;
}

.slider.round:before {
    border-radius: 50%;
}

.switch-text {
    position: absolute;
    width: 100%;
    text-align: center;
    pointer-events: none;
}

/* Filtros y descripción de vacante */
.offcanvas-header, .modal-header {
    background-color: #3d4146 !important;
    color: white !important;
}

.offcanvas-body, .modal-body {
    background-color: #343a40 !important;
    color: white !important;
}

.modal-footer {
    background-color: #3d4146 !important;
    color: white !important;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.form-control {
    background-color:rgb(255, 255, 255) !important;
    color: white !important;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

/* Corregir color de texto en Detalles de la Vacante */
.modal-body .emoji-icon, 
.modal-body .vacante-info, 
.modal-body .vacante-info span, 
.modal-body .list-group-item.bg-transparent.border-secondary {
    color: white !important;
} 

/* Tutorial Modal */
.tutorial-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.7);
    z-index: 2000;
    animation: fadeIn 0.3s ease-in-out;
    overflow-y: auto;
    padding: 20px;
}


.tutorial-content {
    position: relative;
    margin: 40px auto;
    background: rgba(33, 37, 41, 0.95);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    width: 90%;
    max-width: 600px;
    color: white;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    padding: 30px;
    max-height: 90vh;
    overflow-y: auto;
}


.tutorial-note {
    background: rgba(255, 193, 7, 0.1);
    padding: 20px;
    border-radius: 8px;
    border-left: 4px solid #ffc107;
    margin-top: 20px;
    color: white;
}

.tutorial-step {
    display: flex;
    align-items: center;
    gap: 15px;
    background: rgba(255, 255, 255, 0.05);
    padding: 15px;
    border-radius: 8px;
    margin-bottom: 10px;
}

.step-number {
    background: #ffc107;
    color: black;
    width: 30px;
    height: 30px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 16px;
    flex-shrink: 0;
}

.tutorial-footer {
    padding: 20px;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

/* Checkbox personalizado */
.selection-checkbox {
    display: none;
}

.selection-checkbox + label {
    display: inline-block;
    padding: 10px 20px;
    font-size: 16px;
    font-weight: bold;
    text-align: center;
    background-color: #ffc107;
    color: black;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.selection-checkbox:checked + label {
    /* These will be handled by Bootstrap btn-success:checked styles or similar */
    /* background-color: #28a745; */
    color: white;
}

.selection-checkbox + label:after {
    content: "Click para aplicar";
}

.selection-checkbox:checked + label:after {
    content: "Aplicado";
}

/* Estilo para filas de tabla seleccionadas */
tr.selected-row {
    background-color: rgba(40, 167, 69, 0.2) !important; /* Verde claro para la fila de la tabla */
    border: 1px solid #28a745;
    transition: all 0.3s ease-in-out;
}

.table-actions-column > div { /* Renombramos para evitar conflicto si 'actions-column' se usa en tarjetas */
    margin-bottom: 0.5rem; /* Espacio entre el grupo de 2 botones y el grupo de 3 botones */
}

/* Específico para la etiqueta del checkbox DENTRO de la tabla */
.table-actions-column .checkbox-container label {
    padding: 0; /* Bootstrap se encarga del padding con btn-sm */
}

.table-actions-column .btn, /* Todos los botones en la columna de acciones de la tabla */
.table-actions-column .checkbox-container label { /* La etiqueta que parece botón */
    height: 31px; /* Altura fija para todos los botones, ajusta según sea necesario */
    display: flex;
    align-items: center;
    justify-content: center;
}
/* Estilos para Select2 */
.select2-container--bootstrap4 .select2-selection--multiple {
    background-color: RGB(73, 80, 87);
    border: 1px solid RGB(73, 80, 87);
    border-radius: 0.25rem;
    min-height: 38px;
}

.select2-container--bootstrap4 .select2-selection--multiple .select2-selection__choice {
    background-color: #ffc107; /* Amarillo */
    border: 1px solid #e0a800;
    border-radius: 0.25rem;
    padding: 0.25rem 0.5rem;
    margin-right: 0.5rem;
    margin-top: 0.25rem;
    color: #212529; /* Negro */
    font-weight: 500;
}

.select2-container--bootstrap4 .select2-selection--multiple .select2-selection__choice__remove {
    color: #212529;
    margin-right: 0.25rem;
    font-weight: bold;
}

.select2-container--bootstrap4 .select2-selection--multiple .select2-selection__choice__remove:hover {
    color: #000;
}

.select2-container--bootstrap4 .select2-dropdown {
    border-color: RGB(73, 80, 87);
    border-radius: 0.25rem;
    background-color: #f8f9fa;
}

.select2-container--bootstrap4 .select2-results__option--highlighted[aria-selected] {
    background-color: #ffc107;
    color: #212529;
}

.select2-container--bootstrap4 .select2-results__option[aria-selected=true] {
    background-color: #ffc107;
    color: #212529;
}

/* Estilos para la sección de filtros activos */
#active-filters {
    background-color: rgba(255, 255, 255, 0.1);
    border-radius: 0.25rem;
    padding: 0.75rem;
    margin-bottom: 1.5rem;
}

.filter-badge {
    display: inline-block;
    padding: 0.5rem 0.75rem;
    font-size: 0.875rem;
    margin-right: 0.5rem;
    margin-bottom: 0.5rem;
    background-color: #ffc107;
    color: #212529;
    font-weight: 500;
    border-radius: 50px;
}

.filter-badge .remove-filter {
    cursor: pointer;
    margin-left: 5px;
}

.filter-badge .remove-filter:hover {
    color: #dc3545;
}

/* Estilo para los formularios y contenedores */
.offcanvas-body {
    padding: 1.5rem;
}

.form-control, .multiselect {
    background-color: #FFFFFF;
    border: 1px solidrgb(64, 64, 65);
}

.form-label {
    font-weight: 500;
    margin-bottom: 0.5rem;
}

/* Estilo para el encabezado de filtros activos */
#active-filters h6 {
    margin-bottom: 1rem;
    font-weight: 600;
}

/* Personalización para el contenedor de filtros */
.active-filters-container {
    max-height: 200px;
    overflow-y: auto;
    padding: 0.5rem;
    background-color: rgba(248, 249, 250, 0.1);
    border-radius: 0.25rem;
}

/* CSS para mejorar la visualización de Bootstrap-Multiselect */
.btn-group > .multiselect.dropdown-toggle {
    text-align: left;
    height: auto;
    min-height: 38px;
    white-space: normal;
    padding: 5px 12px;
    background-color: #fff;
    border: 1px solid #ced4da;
}

.btn-group > .multiselect:after {
    position: absolute;
    right: 12px;
    top: 50%;
    transform: translateY(-50%);
}

.btn-group > .multiselect.show {
    border-bottom-left-radius: 0;
    border-bottom-right-radius: 0;
}

.multiselect-container {
    width: 100%;
    padding: 5px;
    max-height: 300px;
    overflow-y: auto;
}

.multiselect-container .dropdown-item {
    padding: 5px;
}

.multiselect-container .dropdown-item label {
    cursor: pointer;
    width: 100%;
    margin: 0;
}

.multiselect-container .dropdown-item.active {
    background-color: #f8f9fa;
    color: #212529;
}

.multiselect-container .dropdown-item.active label {
    color: #212529;
}

.multiselect-selected-text {
    display: block;
    width: 100%;
    white-space: normal;
    word-wrap: break-word;
    padding-right: 15px;
}
    /* Estilo para el offcanvas */
    .offcanvas {
        max-width: 400px;
    }
    
    /* Estilos para los multiselect */
    .multiselect-improved + .btn-group {
        width: 100% !important;
    }
    
    .multiselect-improved + .btn-group > .multiselect-container {
        width: 100% !important;
        max-height: 200px;
        overflow-y: auto;
    }
    
    .multiselect-improved + .btn-group > button {
        text-align: left;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        width: 100%;
        position: relative;
        padding-right: 25px;
    }
    
    .multiselect-container > li > a > label {
        padding: 5px 20px 5px 40px;
        white-space: normal;
        word-wrap: break-word;
    }
    
    /* Estilo para las etiquetas de selección */
    .selected-options {
        display: flex;
        flex-wrap: wrap;
        gap: 5px;
        margin-top: 5px;
    }
    
    .option-tag {
        background-color: #f8f9fa;
        border: 1px solid #ddd;
        border-radius: 3px;
        padding: 2px 8px;
        margin: 2px;
        display: inline-flex;
        align-items: center;
        font-size: 0.85rem;
    }
    
    .option-tag .remove-option {
        margin-left: 5px;
        cursor: pointer;
    }
    
    /* Estilos adicionales para mejorar la visualización en el offcanvas */
    .offcanvas-body {
        padding-right: 10px;
        padding-left: 10px;
    }
    
    .filters-container::-webkit-scrollbar {
        width: 5px;
    }
    
    .filters-container::-webkit-scrollbar-track {
        background: rgba(255, 255, 255, 0.1);
    }
    
    .filters-container::-webkit-scrollbar-thumb {
        background-color: rgba(255, 255, 255, 0.3);
        border-radius: 5px;
    }

</style>
{% if not user.is_authenticated %}
<div class="tutorial-modal" id="tutorialModal" title="✨ ¡bienvenido al portal de vacantes!">
<div class="tutorial-content" title="✨ ¡bienvenido al portal de vacantes!">
<div class="tutorial-header" title="✨ ¡bienvenido al portal de vacantes!">
<h4 title="✨ ¡bienvenido al portal de vacantes!">✨ ¡Bienvenido al Portal de Vacantes! ✨</h4>
<br/>
<button class="btn btn-warning" onclick="closeTutorial()" title="Cerrar">Cerrar</button>
<br/>
</div>
<br/>
<div class="tutorial-body" title="1 realiza los filtros correspondientes según">
<div class="tutorial-step" title="1 realiza los filtros correspondientes según">
<span class="step-number">1</span>
<p title="Realiza los filtros correspondientes según lo">Realiza los filtros correspondientes según lo requiera tu perfil.</p>
</div>
<div class="tutorial-step" title="2 revisa las vacantes y ve">
<span class="step-number">2</span>
<p title="Revisa las vacantes y ve seleccionando">Revisa las vacantes y ve seleccionando todas las vacantes que te interesen.</p>
</div>
<div class="tutorial-step" title="3 cuando finalices de seleccionar">
<span class="step-number">3</span>
<p title="Cuando finalices de seleccionar las vacantes">Cuando finalices de seleccionar las vacantes de tu interés oprime el botón "Aplicar a # vacantes".</p>
</div>
<div class="tutorial-note" title="Nota en caso de no aplicar">
<strong>Nota:</strong> En caso de no aplicar a ninguna de las vacantes oprime el botón "Registrar mis datos" para tenerte en cuenta en futuras vacantes.
            </div>
</div>
<div class="tutorial-footer" title="No mostrar de nuevo ¡comenzar registro!">
<label class="no-show-again" title="No mostrar de nuevo">
<input id="noShowAgain" title="Noshowagain" type="checkbox"/> No mostrar de nuevo
            </label>
<button class="btn btn-warning" onclick="closeTutorial()" title="¡comenzar registro!">¡Comenzar Registro!</button>
</div>
</div>
</div>
{% endif %}
{% load humanize %}
<div class="gradient-bg" title="🔍 filtrar vacantes 🧹 borrar filtros">
<div class="container py-5" title="🔍 filtrar vacantes 🧹 borrar filtros">
<!-- Header Section -->
<div class="mb-5" title="🔍 filtrar vacantes 🧹 borrar filtros">
<!-- <h1 class="text-warning mb-4 fw-bold">Listado de Vacantes Activas</h1> -->
<div class="d-flex flex-wrap gap-2 justify-content-center" title="🔍 filtrar vacantes 🧹 borrar filtros">
<div class="d-flex gap-2 w-100 justify-content-center" title="🔍 filtrar vacantes 🧹 borrar filtros">
<button class="btn btn-outline-light btn-sm" data-bs-target="#offcanvasExample" data-bs-toggle="offcanvas" title="🔍 filtrar vacantes" type="button">
                        🔍 Filtrar Vacantes
                    </button>
<button class="btn btn-outline-light btn-sm" onclick="clearFilters()" title="🧹 borrar filtros" type="button">
                        🧹 Borrar Filtros
                    </button>
<button class="btn btn-outline-light btn-sm" onclick="desmarcarVacantes()" title="❌ desmarcar selección" type="button">
                        ❌ Desmarcar Selección
                    </button>
</div>
<div class="d-flex gap-2 w-100 justify-content-center" title="➕ agregar vacante descargar excel vacantes">
                    {% if request.user.is_authenticated %}
                    <a class="btn btn-outline-light btn-sm" href="{% url 'agregar_vacante' %}" title="➕ agregar vacante">
                        ➕ Agregar Vacante
                    </a>
<a class="btn btn-success btn-sm" href="{% url 'descargar_excel' %}" title="Descargar excel vacantes"><i class="fa-solid fa-file-excel"></i> Descargar Excel Vacantes</a>
                    {% endif %}
                </div>
</div>
<!-- Botones de cambio de vista -->
<div class="my-3" title="Ver tarjetas ver tabla">
<div class="btn-group" role="group" title="Ver tarjetas ver tabla">
<button class="btn btn-secondary view-toggle-btn active" id="view-cards" title="Ver tarjetas">
<i class="fas fa-id-card"></i> Ver tarjetas
                    </button>
<button class="btn btn-secondary view-toggle-btn" id="view-table" title="Ver tabla">
<i class="fas fa-table"></i> Ver tabla
                    </button>
</div>
</div>
</div>
<div class="mb-4" id="active-filters" title="✅ filtros activos ❌ ❌">
<h6 class="text-light" title="✅ filtros activos">✅ Filtros Activos</h6>
<div class="active-filters-container" id="active-filters-container" title="Active filters container">
                {% for key, value in filtros.items %}
                    {% if value %}
                        {% if value is list %}
                            {% for val in value %}
                                <span class="filter-badge">
                                    {{ key|title }}: <strong>{{ val }}</strong>
<span class="remove-filter" data-filter-key="{{ key }}" data-filter-value="{{ val }}">❌</span>
</span>
                            {% endfor %}
                        {% else %}
                            <span class="filter-badge">
                                {{ key|title }}: <strong>{{ value }}</strong>
<span class="remove-filter" data-filter-key="{{ key }}" data-filter-value="{{ value }}">❌</span>
</span>
                        {% endif %}
                    {% endif %}
                {% endfor %}
            </div>
</div>
<!-- Job Listings -->
<!-- Vista de Tarjetas Wrapper -->
<div id="cards-view" title="El bucle y la estructura"> {# Nuevo div contenedor para la vista de tarjetas #}
            <div class="grid-container" title="El bucle y la estructura"> {# El div original con la clase grid-container #}
                {% comment %} El bucle y la estructura de la tarjeta permanecen dentro de grid-container {% endcomment %}
            {% for vacante in page_obj %}
            <div class="vacante-card" title="📍 no especificado 🗑️ ✏️ 👥">
<div class="vacante-header" title="📍 no especificado 🗑️ ✏️ 👥">
<div class="checkbox-container" title="📍 no especificado 🗑️ ✏️ 👥">
<div class="vacante-info" title="📍 no especificado 🗑️ ✏️ 👥">
<div class="vacante-title" title="Cargo">{{ vacante.cargo }}</div>
<div class="vacante-location" title="📍 no especificado">
    📍 
    {% if vacante.ciudad %}
        {{ vacante.ciudad }}
    {% elif vacante.departamento %}
        {{ vacante.departamento }}
    {% else %}
        No especificado
    {% endif %}
</div>
                            {% if request.user.is_authenticated %}
                            {% if request.user.is_authenticated %}
                            <br/>
<div class="vacante-actions" title="🗑️ ✏️ 👥 activainactiva">
<form action="{% url 'eliminar_vacante' vacante.id %}" class="d-inline" method="POST" onsubmit="return confirm('¿Estás seguro de que deseas eliminar esta vacante?');">
                                    {% csrf_token %}
                                    <button class="btn btn-outline-danger btn-sm" type="submit">
                                        🗑️
                                    </button>
</form>
<a class="btn btn-outline-info btn-sm" href="{% url 'editar_vacante' vacante.id %}" title="Editar vacante">
                                    ✏️
                                </a>
<a class="btn btn-outline-primary btn-sm" href="{% url 'lista_candidatos' vacante.id %}" title="Lista candidatos">
                                    👥
                                </a>
<form action="{% url 'cambiar_estado_vacante' vacante.id %}" method="POST" style="display: inline;">
                                    {% csrf_token %}
                                    {# Incluir los parámetros GET actuales como campos ocultos para preservar filtros #}
                                    {% for key, value_list in request.GET.lists %}
                                        {% for value in value_list %}
                                            <input name="{{ key }}" title="Django placeholder 52" type="hidden" value="{{ value }}"/>
                                        {% endfor %}
                                    {% endfor %}
                                    <label class="switch">
    <input type="checkbox" onchange="this.form.submit()" {% if vacante.estado %}checked{% endif %}>
    <span class="slider round">
        <span class="switch-text">{% if vacante.estado %}Activa{% else %}Inactiva{% endif %}</span>
    </span>
</label>
</form>
</div>
                            {% endif %}
                            <div class="vacante-meta" title="🧑‍💼 creado 🔁 actualizado 👥 candidatos">
<small title="🧑‍💼 creado">🧑‍💼 Creado: {{ vacante.usuario_publicador.username|default:"No asignado" }} ({{ vacante.fecha_creacion|date:"d/m/Y" }})</small><br/>
<small title="🔁 actualizado">🔁 Actualizado: {{ vacante.usuario_actualizador.username|default:"" }} ({{ vacante.fecha_actualizacion|date:"d/m/Y" }})</small><br/>
<small title="👥 candidatos">👥 Candidatos: {{ vacante.num_candidatos }}</small><br/>
<small title="Id vacante">ID Vacante: {{ vacante.codigo_vacante|default:"No asignado" }}</small>
</div>
                            {% endif %}
                        </div>
</div>
</div>
<div class="badge-container" title="👥 vacantes ⏳ 🎓 🏢 💰">
<div class="info-badge" title="👥 vacantes">
                        👥 {{ vacante.numero_puestos }} vacantes
                    </div>
<div class="info-badge">
                        ⏳ {{ vacante.tiempo_experiencia }}
                    </div>
<div class="info-badge">
                        🎓 {{ vacante.nivel_estudios }}
                    </div>
<div class="info-badge">
                        🏢 {{ vacante.modalidad_trabajo }}
                    </div>
<div class="info-badge" title="💰 $ salario a convenir">
                            {% if vacante.rango_salarial %}
                            💰 $  {{ vacante.rango_salarial|intcomma }}
                            {% else %}
                                Salario a convenir
                            {% endif %}
                    </div>
</div>
<br/>
<!-- Botón de Descripción Vacante - Ocupa toda la parte inferior -->
<div class="mt-auto" title="Descripción vacante">
<button class="btn btn-outline-warning w-100 toggle-info d-flex align-items-center justify-content-center" data-bs-target="#modal-{{ vacante.id }}" data-bs-toggle="modal" title="Descripción vacante" type="button">
                        Descripción Vacante <i class="fas fa-chevron-down toggle-icon ms-2"></i>
</button>
<br/>
                    {% if vacante.estado %}
                    <div class="checkbox-container">
<input class="selection-checkbox" id="check{{ vacante.id }}" onchange="handleSelection(event, '{{ vacante.id }}')" title="Check django placeholder 79" type="checkbox"/>
<label for="check{{ vacante.id }}"></label>
</div>
                    {% endif %}

                </div>
</div>


            {% endfor %}
        </div>
</div> {# Cierre del nuevo div contenedor #}

        <!-- Vista de Tabla -->
<div id="table-view" title="Cargo / id ubicación modalidad salario">
<table class="table table-dark table-striped table-hover">
<thead>
<tr>
<th>Cargo / ID</th>
<th>Ubicación</th>
<th>Modalidad</th>
<th>Salario</th>
                        {% if request.user.is_authenticated %}
                        <th>Estado</th>
                        {% endif %}
                        <th>Acciones</th>
</tr>
</thead>
<tbody>
                    {% for vacante in page_obj %}
                    <tr id="row-{{ vacante.id }}"> {# ID añadido para facilitar la selección con JS #}
                        <td>
<strong>{{ vacante.cargo }}</strong><br/>
<small class="text-muted" title="Codigo vacante">{{ vacante.codigo_vacante }}</small><br/>
<small class="text-muted" title="Empresa">Empresa: {{ vacante.empresa_usuaria }}</small>
</td>
<td>
                            {% if vacante.ciudad %}
                                {{ vacante.ciudad }}
                            {% elif vacante.departamento %}
                                {{ vacante.departamento }}
                            {% else %}
                                No especificado
                            {% endif %}
                        </td>
<td>{{ vacante.modalidad_trabajo }}</td>
<td>
                            {% if vacante.rango_salarial %}
                                $ {{ vacante.rango_salarial|intcomma }}
                            {% else %}
                                A convenir
                            {% endif %}
                        </td>
                        {% if request.user.is_authenticated %}
                        <td>
<form action="{% url 'cambiar_estado_vacante' vacante.id %}" class="d-inline" method="POST">
                                {% csrf_token %}
                                {% for key, value_list in request.GET.lists %}{% for value in value_list %}
                                <input name="{{ key }}" title="Django placeholder 109" type="hidden" value="{{ value }}"/>
                                {% endfor %}{% endfor %}
                                <label class="switch">
    <input type="checkbox" onchange="this.form.submit()" {% if vacante.estado %}checked{% endif %}>
    <span class="slider round">
        <span class="switch-text">{% if vacante.estado %}Activa{% else %}Inactiva{% endif %}</span>
    </span>
</label>
</form>
</td>
                        {% endif %}
                        <td class="table-actions-column"> {# Clase para la columna de acciones de la tabla #}
                            {# Grupo de 2 botones: Detalles y Aplicar #}
                            <div class="d-flex gap-1" title="Detalles">
<button class="btn btn-outline-warning btn-sm flex-fill" data-bs-target="#modal-{{ vacante.id }}" data-bs-toggle="modal" title="Detalles" type="button">
<i class="fas fa-eye"></i> Detalles
                                </button>
                                {% if vacante.estado %}
                                <div class="checkbox-container flex-fill">
<input class="selection-checkbox" id="table-check{{ vacante.id }}" onchange="handleSelection(event, '{{ vacante.id }}')" title="Table check django placeholder 123" type="checkbox"/>
<label class="btn btn-success btn-sm w-100" for="table-check{{ vacante.id }}"></label>
</div>
                                {% endif %}
                            </div>
                            {% if request.user.is_authenticated %}
                            {# Grupo de 3 botones: Admin #}
                            <div class="d-flex gap-1 justify-content-center"> {# Centrar este grupo de botones #}
                                <a class="btn btn-outline-info btn-sm flex-fill" href="{% url 'editar_vacante' vacante.id %}" title="Editar vacante"><i class="fas fa-edit"></i></a>
<a class="btn btn-outline-primary btn-sm flex-fill" href="{% url 'lista_candidatos' vacante.id %}" title="Lista candidatos"><i class="fas fa-users"></i></a>
<form action="{% url 'eliminar_vacante' vacante.id %}" class="d-inline flex-fill" method="POST" onsubmit="return confirm('¿Estás seguro de que deseas eliminar esta vacante?');">
                                    {% csrf_token %}
                                    <button class="btn btn-outline-danger btn-sm w-100" type="submit"><i class="fas fa-trash"></i></button>
</form>
</div>
                            {% endif %}
                        </td>
</tr>
                    {% empty %}
                    <tr><td class="text-center" colspan="{% if request.user.is_authenticated %}6{% else %}5{% endif %}">No se encontraron vacantes.</td></tr>
                    {% endfor %}
                </tbody>
</table>
</div>
</div>
</div>
<div class="pagination justify-content-center mt-4" title="« primera anterior página de .">
<span class="step-links" title="« primera anterior página de .">
        {% if page_obj.has_previous %}
            <a class="btn btn-outline-secondary btn-sm" href="?page=1{% for key, value in request.GET.items %}{% if key != 'page' %}&amp;{{ key }}={{ value }}{% endif %}{% endfor %}" title="« primera">« Primera</a>
<a class="btn btn-outline-secondary btn-sm" href="?page={{ page_obj.previous_page_number }}{% for key, value in request.GET.items %}{% if key != 'page' %}&amp;{{ key }}={{ value }}{% endif %}{% endfor %}" title="Anterior">Anterior</a>
        {% endif %}

        <span class="current mx-2" title="Página de .">
            Página {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}.
        </span>

        {% if page_obj.has_next %}
            <a class="btn btn-outline-secondary btn-sm" href="?page={{ page_obj.next_page_number }}{% for key, value in request.GET.items %}{% if key != 'page' %}&amp;{{ key }}={{ value }}{% endif %}{% endfor %}" title="Siguiente">Siguiente</a>
<a class="btn btn-outline-secondary btn-sm" href="?page={{ page_obj.paginator.num_pages }}{% for key, value in request.GET.items %}{% if key != 'page' %}&amp;{{ key }}={{ value }}{% endif %}{% endfor %}" title="Última »">Última »</a>
        {% endif %}
    </span>
</div>
<!-- Opcional: Selector para cantidad por página -->
<div class="text-center" id="items-por-pagina-selector" title="Vacantes por página 10 20 50"> <!-- ID añadido, mt-2 eliminado para control CSS -->
<form action="" class="d-inline-block" method="get">
        {% for key, value in request.GET.items %}
            {% if key != 'por_pagina' and key != 'page' %}
                <input name="{{ key }}" title="Django placeholder 175" type="hidden" value="{{ value }}"/>
            {% endif %}
        {% endfor %}
        <label for="por_pagina" title="Vacantes por página">Vacantes por página:</label> <!-- Estilo aplicado vía CSS -->
<select class="form-select form-select-sm d-inline-block" id="por_pagina" name="por_pagina" onchange="this.form.submit()" style="width: auto;" title="Por pagina">
<option __django_placeholder_179__selected__django_placeholder_180__="" value="10">10</option>
<option __django_placeholder_181__selected__django_placeholder_182__="" value="20">20</option>
<option __django_placeholder_183__selected__django_placeholder_184__="" value="50">50</option>
</select>
</form>
</div>
<!-- Modals Section (Movido aquí para que no se oculte con el cambio de vista) -->
{% for vacante in page_obj %}
<div aria-hidden="true" aria-labelledby="modalLabel-{{ vacante.id }}" class="modal fade" id="modal-{{ vacante.id }}" role="dialog" tabindex="-1" title="Detalles de la vacante 📝 descripción">
<div class="modal-dialog modal-dialog-centered" role="document" title="Detalles de la vacante 📝 descripción">
<div class="modal-content" title="Detalles de la vacante 📝 descripción">
<div class="modal-header" title="Detalles de la vacante">
<h5 class="modal-title" id="modalLabel-{{ vacante.id }}" title="Detalles de la vacante">Detalles de la Vacante: {{ vacante.cargo }}</h5>
<button aria-label="Close" class="btn-close btn-close-white" data-bs-dismiss="modal" type="button"></button>
</div>
<div class="modal-body" title="📝 descripción de la vacante 📊">
<div class="row" title="📝 descripción de la vacante 📊">
<div class="col-md-12 mb-4" title="📝 descripción de la vacante">
<h6 class="text-warning mb-3" title="📝 descripción de la vacante">📝 Descripción de la Vacante</h6>
<p class="descripcion-vacante" title="Descripcion vacante">{{ vacante.descripcion_vacante }}</p>
</div>
<div class="col-md-6" title="📊 información general 👥 número">
<h6 class="text-warning mb-3" title="📊 información general">📊 Información General</h6>
<ul class="list-group list-group-flush bg-transparent">
<li class="list-group-item bg-transparent border-secondary">
<strong>👥 Número de puestos:</strong> {{ vacante.numero_puestos }}
                            </li>
<li class="list-group-item bg-transparent border-secondary">
<strong>⏳ Experiencia requerida:</strong> {{ vacante.tiempo_experiencia }}
                            </li>
<li class="list-group-item bg-transparent border-secondary">
<strong>🎓 Nivel de estudios:</strong> {{ vacante.nivel_estudios }}
                            </li>
<li class="list-group-item bg-transparent border-secondary">
<strong>📍 Ubicación:</strong> 
                                {% if vacante.ciudad %}{{ vacante.ciudad }}{% elif vacante.departamento %}{{ vacante.departamento }}{% else %}No especificado{% endif %}
                            </li>
</ul>
</div>
<div class="col-md-6" title="💼 condiciones laborales 🏢 modalidad 📄">
<h6 class="text-warning mb-3" title="💼 condiciones laborales">💼 Condiciones Laborales</h6>
<ul class="list-group list-group-flush bg-transparent">
<li class="list-group-item bg-transparent border-secondary"><strong>🏢 Modalidad:</strong> {{ vacante.modalidad_trabajo }}</li>
<li class="list-group-item bg-transparent border-secondary"><strong>📄 Tipo de contrato:</strong> {{ vacante.tipo_contrato }}</li>
<li class="list-group-item bg-transparent border-secondary"><strong>⏰ Jornada:</strong> {{ vacante.jornada_trabajo }}</li>
<li class="list-group-item bg-transparent border-secondary">
<strong>💰 Salario:</strong>
                                {% if vacante.rango_salarial %}$ {{ vacante.rango_salarial|intcomma }}{% else %}A convenir{% endif %}
                            </li>
</ul>
</div>
                    {% if request.user.is_authenticated %}
                    <div class="col-md-12 mb-4" title="📅 datos de citación a convocatoria">
<br/>
<h6 class="text-warning mb-3" title="📅 datos de citación a convocatoria">📅 Datos de citación a convocatoria</h6>
<p class="descripcion-vacante" title="Citacion convocatoria">{{ vacante.citacion_convocatoria }}</p>
</div> 
                    {% endif %}                                                               
                </div>
</div>
<div class="modal-footer" title="Seleccionar vacante cerrar">
                {% if vacante.estado %}
                <div class="form-check form-check-inline" title="Seleccionar vacante">
<input class="form-check-input" id="modal-check{{ vacante.id }}" onchange="handleSelection(event, '{{ vacante.id }}')" title="Modal check django placeholder 211" type="checkbox" value="{{ vacante.id }}"/>
<label class="form-check-label" for="modal-check{{ vacante.id }}" title="Seleccionar vacante">
                        Seleccionar vacante
                    </label>
</div>
                {% endif %}
                <button class="btn btn-outline-light" data-bs-dismiss="modal" title="Cerrar" type="button">Cerrar</button>
</div>
</div>
</div>
</div>
{% endfor %}


<!-- Floating Action Button -->
<a class="btn btn-warning floating-button d-none" href="{% url 'registro_candidato' %}" id="registroButton" onclick="redirectToRegistro(event)" title="✨ registrar mis datos">
    ✨ Registrar mis datos
</a>
<!-- Offcanvas Filter -->
<div class="offcanvas offcanvas-start" id="offcanvasExample" tabindex="-1" title="🔍 filtrar vacantes 📊 estado activa">
<div class="offcanvas-header" title="🔍 filtrar vacantes">
<h5 class="offcanvas-title text-light" title="🔍 filtrar vacantes">🔍 Filtrar Vacantes</h5>
<button class="btn-close btn-close-white" data-bs-dismiss="offcanvas" type="button"></button>
</div>
<div class="offcanvas-body" title="📊 estado activa inactiva 🔎 id">
<!-- Contenedor con desplazamiento para manejo de contenido largo -->
<div class="filters-container" title="📊 estado activa inactiva 🔎 id">
<form action="" id="filter-form" method="GET">
<div class="mb-3" title="📊 estado activa inactiva 🔎 id">
                {# --- FILTRO DE ESTADO (Estilo Área - Adaptado para Boolean) --- #}
                {% if request.user.is_authenticated %}
                <div class="mb-3" title="📊 estado activa inactiva">
<label class="form-label text-light" for="estado" title="📊 estado">📊 Estado</label>
                    {# Asegúrate de usar la misma clase JS que para Área si usas una librería #}
                    <select class="form-control multiselect-improved" id="estado" multiple="multiple" name="estado" title="Activa inactiva">
                        {# Opciones escritas directamente con value="True" y value="False" #}
                        {# La condición 'selected' busca los strings 'True' o 'False' en la lista de filtros #}
                        <option __django_placeholder_223__selected__django_placeholder_224__="" title="Activa" value="True">Activa</option>
<option __django_placeholder_225__selected__django_placeholder_226__="" title="Inactiva" value="False">Inactiva</option>
</select>
                    {# Ya NO necesitas el bucle {% for %} ni la variable estado_choices #}
                </div>
                {% endif %}
                {# --- FIN FILTRO DE ESTADO --- #}
                {% if request.user.is_authenticated %}
                <div class="mb-3" title="🔎 id vacante">
<label class="form-label text-light" for="codigo_vacante" title="🔎 id vacante">🔎 ID Vacante</label>
<input class="form-control" id="codigo_vacante" name="codigo_vacante" title="Codigo vacante" type="text" value="{{ request.GET.codigo_vacante }}"/>
</div>
                {% endif %}

                {% if request.user.is_authenticated %}
                {# Filtro por Usuario Publicador #}
                <div class="mb-3" title="👤 creado por">
<label class="form-label text-light" for="usuario_publicador" title="👤 creado por">👤 Creado por</label>
                    {# Asume que pasas 'usuarios_publicadores' desde la vista #}
                    {# Y 'filtros.usuario_publicador_list' contiene los IDs seleccionados #}
                    <select class="form-control multiselect-improved" id="usuario_publicador" multiple="multiple" name="usuario_publicador" title="Usuario publicador">
                        {% for usuario in usuarios_publicadores %}
                            <option __django_placeholder_239__selected__django_placeholder_240__="" value="{{ usuario.id }}">
                                {{ usuario.username }} {# O usuario.get_full_name si prefieres #}
                            </option>
                        {% endfor %}
                    </select>
</div>
                {% endif %}

                <div class="mb-3" title="💼 cargo">
<label class="form-label text-light" for="cargo" title="💼 cargo">💼 Cargo</label>
<input class="form-control" id="cargo" name="cargo" title="Cargo" type="text" value="{{ request.GET.cargo }}"/>
</div>
<div class="mb-3" title="🎯 área">
<label class="form-label text-light" for="area" title="🎯 área">🎯 Área</label>
<select class="form-control multiselect-improved" id="area" multiple="multiple" name="area" title="Area">
                        {% for value, label in area_choices %}
                            <option __django_placeholder_248__selected__django_placeholder_249__="" title="Label" value="{{ value }}">{{ label }}</option>
                        {% endfor %}
                    </select>
</div>
<div class="mb-3" title="🏢 modalidad de trabajo">
<label class="form-label text-light" for="modalidad_trabajo" title="🏢 modalidad de trabajo">🏢 Modalidad de Trabajo</label>
<select class="form-control multiselect-improved" id="modalidad_trabajo" multiple="multiple" name="modalidad_trabajo" title="Modalidad trabajo">
                        {% for value, label in modalidad_trabajo_choices %}
                            <option __django_placeholder_254__selected__django_placeholder_255__="" title="Label" value="{{ value }}">{{ label }}</option>
                        {% endfor %}
                    </select>
</div>
<div class="mb-3" title="📄 tipo de contrato">
<label class="form-label text-light" for="tipo_contrato" title="📄 tipo de contrato">📄 Tipo de Contrato</label>
<select class="form-control multiselect-improved" id="tipo_contrato" multiple="multiple" name="tipo_contrato" title="Tipo contrato">
                        {% for value, label in tipo_contrato_choices %}
                            <option __django_placeholder_260__selected__django_placeholder_261__="" title="Label" value="{{ value }}">{{ label }}</option>
                        {% endfor %}
                    </select>
</div>
<div class="mb-3" title="⏰ jornada de trabajo">
<label class="form-label text-light" for="jornada_trabajo" title="⏰ jornada de trabajo">⏰ Jornada de Trabajo</label>
<select class="form-control multiselect-improved" id="jornada_trabajo" multiple="multiple" name="jornada_trabajo" title="Jornada trabajo">
                        {% for value, label in jornada_trabajo_choices %}
                            <option __django_placeholder_266__selected__django_placeholder_267__="" title="Label" value="{{ value }}">{{ label }}</option>
                        {% endfor %}
                    </select>
</div>
<div class="mb-3" title="⌛ tiempo de experiencia">
<label class="form-label text-light" for="tiempo_experiencia" title="⌛ tiempo de experiencia">⌛ Tiempo de Experiencia</label>
<select class="form-control multiselect-improved" id="tiempo_experiencia" multiple="multiple" name="tiempo_experiencia" title="Tiempo experiencia">
                        {% for value, label in tiempo_experiencia_choices %}
                            <option __django_placeholder_272__selected__django_placeholder_273__="" title="Label" value="{{ value }}">{{ label }}</option>
                        {% endfor %}
                    </select>
</div>
<div class="mb-3" title="🎓 nivel de estudios">
<label class="form-label text-light" for="nivel_estudios" title="🎓 nivel de estudios">🎓 Nivel de Estudios</label>
<select class="form-control multiselect-improved" id="nivel_estudios" multiple="multiple" name="nivel_estudios" title="Nivel estudios">
                        {% for value, label in nivel_estudios_choices %}
                            <option __django_placeholder_278__selected__django_placeholder_279__="" title="Label" value="{{ value }}">{{ label }}</option>
                        {% endfor %}
                    </select>
</div>
<div class="mb-3" title="📍 ciudad bogotá d.c.">
<label class="form-label text-light" for="ciudad" title="📍 ciudad">📍 Ciudad</label>
<select class="form-control multiselect-improved" id="ciudad" multiple="multiple" name="ciudad" title="Bogotá d.c.">
                        {# --- Opción Manual para Bogotá D.C. --- #}
                        {# ¡IMPORTANTE! Reemplaza '1217' con el ID numérico REAL de Bogotá D.C. #}
                        {% with bogota_id_str='1217' %} {# <-- Usamos el ID como string directamente #}
                        <option __django_placeholder_287__selected__django_placeholder_288__="" title="Bogotá d.c." value="{{ bogota_id_str }}">Bogotá D.C.</option>
                        {% endwith %}
                    
                        <!-- Recorrer las ciudades de Cundinamarca -->
                        {% for ciudad in ciudades_cundinamarca %}
                            <option __django_placeholder_292__selected__django_placeholder_293__="" title="Nombre" value="{{ ciudad.id }}">{{ ciudad.nombre }}</option>
                        {% endfor %}
                    </select>
</div>
<div class="mb-3" title="💰 rango salarial">
<label class="form-label text-light" for="rango_salarial_min" title="💰 rango salarial">💰 Rango Salarial</label>
<div class="d-flex gap-2">
<input class="form-control" id="rango_salarial_min" name="rango_salarial_min" placeholder="Desde" title="Desde" type="text" value="{{ filtros.rango_salarial_min }}"/>
<input class="form-control" id="rango_salarial_max" name="rango_salarial_max" placeholder="Hasta" title="Hasta" type="text" value="{{ filtros.rango_salarial_max }}"/>
</div>
</div>
<div class="d-grid gap-2 mt-4 mb-3" title="🔍 aplicar filtros 🧹 borrar filtros">
<button class="btn btn-primary" title="🔍 aplicar filtros" type="submit">
                        🔍 Aplicar Filtros
                    </button>
<button class="btn btn-danger" onclick="clearFilters()" title="🧹 borrar filtros" type="button">
                        🧹 Borrar Filtros
                    </button>
</div>
</div></form>
</div>
</div>
</div>
<script> // Filtros Vacantes
    $(document).ready(function() {
        $('.multiselect-improved').select2({
            theme: 'bootstrap-5',
            placeholder: 'Seleccionar',
            allowClear: true,
            width: '100%',
            dropdownParent: $('#offcanvasExample'),
            multiple: true,
            closeOnSelect: false,
            selectOnClose: false,
            language: {
                noResults: function () {
                    return "No se encontraron resultados";
                }
            },
        });
    });
    
    // Función para limpiar filtros
    function clearFilters() {
        // Limpia todos los select2
        $('.multiselect-improved').val(null).trigger('change');
        
        // Limpia inputs de texto
        $('#codigo_vacante, #cargo, #rango_salarial_min, #rango_salarial_max').val('');
    }
    </script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        document.getElementById("active-filters-container").addEventListener("click", function (event) {
            if (event.target.classList.contains("remove-filter")) {
                let filterKey = event.target.getAttribute("data-filter-key");
                let filterValue = event.target.getAttribute("data-filter-value");
    
                // Eliminar el filtro correspondiente
                let filterElement = document.getElementById(filterKey);
                if (filterElement) {
                    if (filterElement.tagName === "SELECT") {
                        // Si es un select múltiple, eliminar solo el valor específico
                        let selectedValues = Array.from(filterElement.selectedOptions)
                            .map(option => option.value)
                            .filter(value => value !== filterValue);
    
                        // Actualizar valores del select
                        $(filterElement).val(selectedValues).trigger('change');
                    } else {
                        // Si es un input de texto, simplemente vaciarlo
                        filterElement.value = "";
                    }
                }
    
                // Enviar el formulario automáticamente para actualizar los resultados
                document.getElementById("filter-form").submit();
            }
        });
    });
    


// Inicialización de los multiselect con Select2
$(document).ready(function() {
    // Inicializar todos los multiselect
    $('.multiselect').select2({
        theme: 'bootstrap4',
        width: '100%',
        allowClear: true,
        closeOnSelect: false,
        multiple: true
    });

    // Gestionar relación dinámica entre departamentos y ciudades
    $('#departamento').on('change', function() {
        const departamentos = $(this).val() || [];
        
        if (departamentos.length > 0) {
            // Llamada AJAX para obtener ciudades de los departamentos seleccionados
            $.ajax({
                url: '/api/ciudades-por-departamentos/',
                data: { 'departamentos': departamentos.join(',') },
                dataType: 'json',
                success: function(data) {
                    const ciudadSelect = $('#ciudad');
                    const selectedCiudades = ciudadSelect.val() || [];
                    
                    // Mantener las ciudades ya seleccionadas que pertenezcan a los departamentos
                    ciudadSelect.empty();
                    
                    data.forEach(function(ciudad) {
                        const option = new Option(ciudad.nombre, ciudad.id, false, selectedCiudades.includes(ciudad.id.toString()));
                        ciudadSelect.append(option);
                    });
                    
                    ciudadSelect.trigger('change');
                }
            });
        }
    });

    // Actualizar filtros activos cuando cambie cualquier filtro
    updateActiveFilters();
    
    // Eventos para actualizar la visualización de filtros activos
    $('.multiselect, #cargo, #codigo_vacante, #rango_salarial_min, #rango_salarial_max').on('change', function() {
        updateActiveFilters();
    });
});

// Función para actualizar la sección de filtros activos
// Función para actualizar la sección de filtros activos
function updateActiveFilters() {
    const filterContainer = $('#active-filters-container');
    filterContainer.empty();
    
    let hasActiveFilters = false;
    
    // Verificar y mostrar cada tipo de filtro
    const filterTypes = [
        { id: 'codigo_vacante', label: 'ID Vacante', type: 'text', icon: '🔎' },
        { id: 'cargo', label: 'Cargo', type: 'text', icon: '💼' },
        { id: 'area', label: 'Área', type: 'select', icon: '🎯' },
        { id: 'estado', label: 'Estado', type: 'select', icon: '📊' },
        { id: 'usuario_publicador', label: 'Publicador', type: 'select', icon: '👤' },
        { id: 'ciudad', label: 'Ciudad', type: 'select', icon: '📍' },
        { id: 'modalidad_trabajo', label: 'Modalidad', type: 'select', icon: '🏢' },
        { id: 'tipo_contrato', label: 'Contrato', type: 'select', icon: '📄' },
        { id: 'jornada_trabajo', label: 'Jornada', type: 'select', icon: '⏰' },
        { id: 'tiempo_experiencia', label: 'Experiencia', type: 'select', icon: '⌛' },
        { id: 'nivel_estudios', label: 'Estudios', type: 'select', icon: '🎓' },
        { id: 'departamento', label: 'Departamento', type: 'select', icon: '🌍' }
    ];
    
    // Añadir filtros de rango salarial
    const minSalario = $('#rango_salarial_min').val();
    const maxSalario = $('#rango_salarial_max').val();
    
    if (minSalario || maxSalario) {
        hasActiveFilters = true;
        let salarioText = '💰 Salario: ';
        
        if (minSalario && maxSalario) {
            salarioText += `$${minSalario} - $${maxSalario}`;
        } else if (minSalario) {
            salarioText += `Desde $${minSalario}`;
        } else {
            salarioText += `Hasta $${maxSalario}`;
        }
        
        addFilterBadge(filterContainer, 'salario', salarioText);
    }
    
    // Procesar cada tipo de filtro
    filterTypes.forEach(filter => {
        const element = $(`#${filter.id}`);
        
        if (filter.type === 'text' && element.val()) {
            hasActiveFilters = true;
            addFilterBadge(filterContainer, filter.id, `${filter.icon} ${filter.label}: ${element.val()}`);
        } 
        else if (filter.type === 'select') {
            const selectedValues = element.val();
            if (selectedValues && selectedValues.length > 0) {
                hasActiveFilters = true;
                
                // Para selects múltiples, mostrar cada selección individual
                selectedValues.forEach(function(value) {
                    const optionText = element.find(`option[value="${value}"]`).text();
                    addFilterBadge(filterContainer, `${filter.id}-${value}`, `${filter.icon} ${filter.label}: ${optionText}`);
                });
            }
        }
    });
    
    
    // Mostrar mensaje si no hay filtros activos
    if (!hasActiveFilters) {
        filterContainer.html('<span class="text-light">No hay filtros aplicados</span>');
    }
}// Función para añadir una insignia de filtro
function addFilterBadge(container, id, text) {
    const badge = $(`<span class="badge filter-badge" data-filter-id="${id}">${text} <i class="fas fa-times remove-filter"></i></span>`);
    
    // Agregar evento para eliminar filtro individual
    badge.find('.remove-filter').on('click', function() {
        removeFilter(id);
    });
    
    container.append(badge);
}

// Función para eliminar filtro individual
function removeFilter(filterId) {
    // Diferentes acciones dependiendo del tipo de filtro
    if (filterId === 'salario') {
        $('#rango_salarial_min, #rango_salarial_max').val('');
    } else if (filterId === 'cargo' || filterId === 'codigo_vacante') {
        $(`#${filterId}`).val('');
    } else {
        // Para filtros multiselect, extraer el ID del campo y el valor
        const parts = filterId.split('-');
        if (parts.length === 2) {
            const fieldId = parts[0];
            const valueToRemove = parts[1];
            
            // Obtener valores actuales, quitar el valor específico
            const select = $(`#${fieldId}`);
            const currentValues = select.val() || [];
            const newValues = currentValues.filter(v => v !== valueToRemove);
            
            select.val(newValues).trigger('change');
        }
    }
    
    // Actualizar visualización de filtros
    updateActiveFilters();
}

// Función para limpiar todos los filtros
function clearFilters() {
    // Limpiar los campos de texto
    $('#cargo, #codigo_vacante, #rango_salarial_min, #rango_salarial_max').val('');
    
    // Limpiar los select múltiples
    $('.multiselect').val(null).trigger('change');
    
    // Actualizar los filtros activos
    updateActiveFilters();
}
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.querySelector('.offcanvas-body form');
        
        form.addEventListener('submit', function(event) {
            // Obtener los inputs
            const minInput = document.getElementById('rango_salarial_min');
            const maxInput = document.getElementById('rango_salarial_max');
    
            // Remover puntos antes de enviar
            if (minInput.value) {
                minInput.value = minInput.value.replace(/\./g, '');
            }
            if (maxInput.value) {
                maxInput.value = maxInput.value.replace(/\./g, '');
            }
        });
    }); 
    
    // =================================================================================
    // INICIO DEL BLOQUE DE SCRIPT UNIFICADO
    // =================================================================================

    // Array global para almacenar los IDs de las vacantes seleccionadas
    let selectedVacantes = [];

    // --- MANEJO DE SELECCIÓN DE VACANTES ---

    // Función unificada para manejar la selección desde cualquier checkbox (tarjeta, tabla, modal)
    window.handleSelection = function(event, vacanteId) {
        const isChecked = event.target.checked;

        // Actualizar el array de vacantes seleccionadas
        if (isChecked) {
            if (!selectedVacantes.includes(vacanteId)) {
                selectedVacantes.push(vacanteId);
            }
        } else {
            selectedVacantes = selectedVacantes.filter(id => id !== vacanteId);
        }

        // Actualizar el localStorage
        localStorage.setItem('selectedVacantes', JSON.stringify(selectedVacantes));

        // Sincronizar el estado visual de todos los elementos relacionados
        updateVacanteVisualState(vacanteId, isChecked);

        // Actualizar el botón flotante
        updateFloatingButton();
    }

    // Función para actualizar el estado visual de todos los elementos de una vacante
    function updateVacanteVisualState(vacanteId, isChecked) {
        // Checkbox de la vista de tarjeta y la tarjeta misma
        const cardCheckbox = document.getElementById('check' + vacanteId);
        if (cardCheckbox) {
            cardCheckbox.checked = isChecked;
            const vacanteCard = cardCheckbox.closest('.vacante-card');
            if (vacanteCard) {
                vacanteCard.classList.toggle('selected', isChecked);
            }
        }

        // Checkbox de la vista de tabla y la fila de la tabla
        const tableCheckbox = document.getElementById('table-check' + vacanteId);
        if (tableCheckbox) {
            tableCheckbox.checked = isChecked;
            const tableRow = document.getElementById('row-' + vacanteId);
            if (tableRow) {
                tableRow.classList.toggle('selected-row', isChecked);
            }
        }

        // Checkbox del modal
        const modalCheckbox = document.getElementById('modal-check' + vacanteId);
        if (modalCheckbox) {
            modalCheckbox.checked = isChecked;
        }
    }

    // --- FUNCIONES DEL BOTÓN FLOTANTE Y ACCIONES ---

    function updateFloatingButton() {
        const button = document.getElementById('registroButton');
        if (!button) return;

        if (selectedVacantes.length === 0) {
            button.innerHTML = '✨ Registrar mis datos';
            button.classList.remove('d-none');
            button.classList.remove('btn-success');
            button.classList.add('btn-warning');
        } else {
            button.innerHTML = `🎯 Aplicar a ${selectedVacantes.length} vacante${selectedVacantes.length > 1 ? 's' : ''}`;
            button.classList.remove('d-none');
            button.classList.remove('btn-warning');
            button.classList.add('btn-success');
        }
    }

    window.redirectToRegistro = function(event) {
        event.preventDefault();
        const url = "{% url 'registro_candidato' %}?selected_vacantes=" + selectedVacantes.join(',');
        window.location.href = url;
    }

    window.desmarcarVacantes = function() {
        const currentSelections = [...selectedVacantes];
        selectedVacantes = [];
        localStorage.setItem('selectedVacantes', JSON.stringify(selectedVacantes));
        currentSelections.forEach(id => updateVacanteVisualState(id, false));
        updateFloatingButton();
    }

    // --- LÓGICA DE INICIALIZACIÓN AL CARGAR LA PÁGINA ---

    document.addEventListener('DOMContentLoaded', function() {
        // Cargar selecciones guardadas del localStorage
        const stored = localStorage.getItem('selectedVacantes');
        if (stored) {
            selectedVacantes = JSON.parse(stored);
            selectedVacantes.forEach(id => {
                updateVacanteVisualState(id, true);
            });
        }
        updateFloatingButton();

        // Lógica para el botón de desmarcar (ya definida arriba)

        // Lógica para el tutorial
        showTutorial();

        // Lógica para el cambio de vista (tarjetas/tabla)
        initializeViewToggle();

        // Lógica para los filtros
        initializeFilters();
    });

    // --- LÓGICA DE CAMBIO DE VISTA ---
    function initializeViewToggle() {
        const viewCardsBtn = document.getElementById('view-cards');
        const viewTableBtn = document.getElementById('view-table');
        const cardsViewDiv = document.getElementById('cards-view');
        const tableViewDiv = document.getElementById('table-view');

        function aplicarVistaGuardada() {
            const vistaGuardada = localStorage.getItem('vistaVacantesPreferida');
            if (vistaGuardada === 'tabla') {
                cardsViewDiv.style.display = 'none';
                tableViewDiv.style.display = 'block';
                viewTableBtn.classList.add('active');
                viewCardsBtn.classList.remove('active');
            } else {
                cardsViewDiv.style.display = 'block';
                tableViewDiv.style.display = 'none';
                viewCardsBtn.classList.add('active');
                viewTableBtn.classList.remove('active');
            }
            // Una vez que el script ha aplicado la vista correcta, eliminamos la clase
            // de anti-parpadeo para que los clics posteriores funcionen normalmente.
            document.documentElement.classList.remove('vista-tabla-inicial');
        }

        viewCardsBtn.addEventListener('click', function() {
            localStorage.setItem('vistaVacantesPreferida', 'tarjetas');
            aplicarVistaGuardada();
        });

        viewTableBtn.addEventListener('click', function() {
            localStorage.setItem('vistaVacantesPreferida', 'tabla');
            aplicarVistaGuardada();
        });

        aplicarVistaGuardada();
    }

    // --- LÓGICA DE FILTROS ---
    function initializeFilters() {
        // Formateo de números para el salario
        const formatNumber = (input) => {
            if (!input) return;
            let value = input.value.replace(/\./g, '');
            if (!isNaN(value) && value !== '') {
                value = parseInt(value).toLocaleString('es-CO');
                input.value = value;
            } else {
                input.value = '';
            }
        };
        const minInput = document.getElementById('rango_salarial_min');
        const maxInput = document.getElementById('rango_salarial_max');
        if (minInput) minInput.addEventListener('input', () => formatNumber(minInput));
        if (maxInput) maxInput.addEventListener('input', () => formatNumber(maxInput));

        // Limpiar puntos antes de enviar el formulario de filtros
        const filterForm = document.getElementById('filter-form');
        if (filterForm) {
            filterForm.addEventListener('submit', function(event) {
                if (minInput && minInput.value) minInput.value = minInput.value.replace(/\./g, '');
                if (maxInput && maxInput.value) maxInput.value = maxInput.value.replace(/\./g, '');
            });
        }
    }

    window.clearFilters = function() {
        const form = document.getElementById('filter-form');
        if (form) {
            form.reset();
            // Para Select2, necesitas un tratamiento especial para limpiar
            $(form).find('select.multiselect-improved').val(null).trigger('change');
        }
        // Opcional: enviar el formulario para ver los resultados sin filtros
        // form.submit(); 
        // O redirigir a la página sin parámetros de filtro
        window.location.href = window.location.pathname;
    }

    // --- LÓGICA DEL TUTORIAL ---
    function showTutorial() {
        const noShow = localStorage.getItem('noShowTutorial');
        const tutorialModal = document.getElementById('tutorialModal');
        if (!noShow && tutorialModal) {
            tutorialModal.style.display = 'block';
        }
    }

    window.closeTutorial = function() {
        const tutorialModal = document.getElementById('tutorialModal');
        const noShowAgainCheckbox = document.getElementById('noShowAgain');
        if (tutorialModal) tutorialModal.style.display = 'none';
        if (noShowAgainCheckbox && noShowAgainCheckbox.checked) {
            localStorage.setItem('noShowTutorial', 'true');
        }
    }

    // Para compatibilidad, se mantienen las funciones antiguas que ahora están vacías o llaman a la nueva lógica
    // Esto es por si algún otro script las estuviera llamando, aunque lo ideal es eliminar estas llamadas.
    function handleVacanteSelection(vacanteId) {
        // Esta función ahora es manejada por handleSelection
        console.warn("handleVacanteSelection está obsoleta. Usar handleSelection en su lugar.");
    }
    function handleModalSelection(vacanteId) {
        // Esta función ahora es manejada por handleSelection
        console.warn("handleModalSelection está obsoleta. Usar handleSelection en su lugar.");
    }

    // =================================================================================
    // FIN DEL BLOQUE DE SCRIPT UNIFICADO
    // =================================================================================

</script>
{% endblock %}